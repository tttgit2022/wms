/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Image IO JS Edition
* @website http://www.dynamsoft.com
* @copyright Copyright 2022, Dynamsoft Corporation
* @author Dynamsoft
* @version 1.7.3 (2022-06-22T11:11:05.912Z)
* @fileoverview Dynamsoft JavaScript Library for Image IO
* 
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).Dynamsoft=e.Dynamsoft||{},e.Dynamsoft.ImageIO={}))}(this,(function(e){"use strict";function t(e,t,i,s){return new(i||(i=Promise))((function(a,n){function r(e){try{l(s.next(e))}catch(e){n(e)}}function o(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))}function i(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)}function s(e,t,i,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,i):a?a.value=i:t.set(e,i),i}var a,n,r,o,l,d,u,c,h,f,m,p,g,v,y,T,_,k,I,S,R,w,M,P,b,A,B,x,D,W,F,O,L,C,E,N,j,H,J,z,U,G,V,Y,q,K,Q,X,Z,$,ee,te,ie,se,ae,ne,re,oe,le,de,ue,ce,he,fe,me,pe,ge,ve,ye,Te,_e,ke,Ie,Se,Re,we,Me,Pe,be,Ae,Be,xe,De,We,Fe,Oe,Le,Ce,Ee,Ne,je,He,Je,ze,Ue,Ge,Ve,Ye,qe,Ke,Qe,Xe,Ze,$e,et,tt,it,st,at,nt,rt,ot,lt,dt,ut,ct,ht,ft,mt,pt,gt,vt,yt,Tt,_t,kt,It,St,Rt,wt,Mt,Pt,bt,At,Bt,xt,Dt,Wt,Ft,Ot,Lt,Ct;!function(e){e.logInfo="logInfo",e.logDebug="logDebug",e.logAll="logAll",e.imgIO="imgIO",e.core="imgCore",e.imgProc="imgProc",e.pdfR="pdfReader",e.pdfW="pdfWriter",e.crypto="crypto",e.binaryBlobType="application/octet-stream",e.wasmExtension=".wasm"}(a||(a={})),function(e){e.pending="pending",e.ready="ready",e.failed="failed",e.destroyed="destroyed",e.init="init"}(n||(n={})),function(e){e.PARAMETER_TYPE_ERROR="Parameter Type not Supported = ",e.TIMEOUT="Timeout no Response = ",e.FILE_STREAM_ERROR="File Stream Error = ",e.WASM_EXCEPTION_ERROR="An WASM exception occurred."}(r||(r={})),function(e){e[e.LONG_KEY=0]="LONG_KEY",e[e.DLS_KEY=1]="DLS_KEY"}(o||(o={})),function(e){e[e.wasmBase=-4e3]="wasmBase",e[e.wasmException=-4001]="wasmException",e[e.wasmNoModule=-4002]="wasmNoModule",e[e.wasmJsBase=-4100]="wasmJsBase",e[e.wasmJsObjectNotInit=-4101]="wasmJsObjectNotInit",e[e.wasmJsObjectTerminated=-4102]="wasmJsObjectTerminated",e[e.wasmJsObjectInitFailed=-4103]="wasmJsObjectInitFailed",e[e.wasmJsNotLoaded=-4104]="wasmJsNotLoaded",e[e.wasmJsInvalidJson=-4105]="wasmJsInvalidJson",e[e.wasmJsWorkerRunException=-4106]="wasmJsWorkerRunException",e[e.wasmJsWorkerRunFailed=-4107]="wasmJsWorkerRunFailed",e[e.wasmJsReadFileFailed=-4108]="wasmJsReadFileFailed",e[e.wasmJsCoreTaskException=-4109]="wasmJsCoreTaskException",e[e.wasmJsProcTaskException=-4110]="wasmJsProcTaskException",e[e.wasmJsSavePdfFailed=-4111]="wasmJsSavePdfFailed",e[e.wasmJsSaveTiffFailed=-4112]="wasmJsSaveTiffFailed"}(l||(l={})),e.ImageType=void 0,(d=e.ImageType||(e.ImageType={}))[d.IT_DIB=-1]="IT_DIB",d[d.IT_RGBA=-2]="IT_RGBA",d[d.IT_BGRA=-3]="IT_BGRA",d[d.IT_BMP=0]="IT_BMP",d[d.IT_JPG=1]="IT_JPG",d[d.IT_PNG=3]="IT_PNG",d[d.IT_ALL=5]="IT_ALL",e.ReturnedDataType=void 0,(u=e.ReturnedDataType||(e.ReturnedDataType={}))[u.RT_AUTO=-1]="RT_AUTO",u[u.RT_BINARY=1]="RT_BINARY",u[u.RT_BASE64=2]="RT_BASE64",function(e){e[e.SF_DEF=0]="SF_DEF",e[e.SF_ENABLE=1]="SF_ENABLE",e[e.SF_DISABLE=2]="SF_DISABLE"}(c||(c={}));!function(e){e.imgIOVer="1.7.3",e.coreVer="1.7.3",e.imgProcVer="1.7.3",e.pdfRVer="1.7.3",e.pdfWVer="1.7.3",e.cryptoVer="1.7.3"}(L||(L={}));class Et{static get UseSimd(){return i(this,h,"f",y)}static set UseSimd(e){s(this,h,e,"f",y)}static get License(){return i(this,h,"f",f)}static set License(e){s(this,h,e,"f",f)}static get LicMode(){return i(this,h,"f",m)}static set LicMode(e){s(this,h,e,"f",m),i(this,h,"m",_).call(this)}static get UUID(){return i(this,h,"f",p)}static set UUID(e){s(this,h,e,"f",p)}static get NavInfo(){return i(this,h,"f",g)}static set NavInfo(e){s(this,h,e,"f",g)}static get Mobile(){return i(this,h,"f",v)}static set Mobile(e){s(this,h,e,"f",v)}static get DefHeapSize(){return i(this,h,"f",k)}static set DefHeapSize(e){s(this,h,e,"f",k)}static get MaxHeapSize(){return i(this,h,"f",I)}static get ImageIOWorkerJS(){return"dynamsoft.imageio_wasm-"+L.imgIOVer+".js"}static get PdfReaderWorkerJS(){return"dynamsoft.pdfReader_wasm-"+L.pdfRVer+".js"}static get ImageIOPrefixName(){return"dynamsoft.imageio-"}static get ImagecorePrefixName(){return"dynamsoft.imagecore-"}static get ImageProcPrefixName(){return"dynamsoft.imageProc-"}static get PdfReaderPrefixName(){return"dynamsoft.pdfReader-"}static get PdfWriterPrefixName(){return"dynamsoft.pdfWriter-"}static get CryptoPrefixName(){return"dynamsoft.crypto-"}static get ImageIOResource(){return i(this,h,"f",w)}static set ImageIOResource(e){s(this,h,i(this,h,"m",S).call(this,e),"f",w),i(this,h,"m",P).call(this,i(this,h,"f",w),this.imageIOModule),i(this,h,"m",P).call(this,i(this,h,"f",w),i(this,h,"f",b)),i(this,h,"m",P).call(this,i(this,h,"f",w),i(this,h,"f",B)),i(this,h,"m",P).call(this,i(this,h,"f",w),i(this,h,"f",x))}static get PdfReaderResource(){return i(this,h,"f",M)}static set PdfReaderResource(e){e.useFastCompEdition=!1,s(this,h,i(this,h,"m",S).call(this,e),"f",M),i(this,h,"m",P).call(this,i(this,h,"f",M),i(this,h,"f",A)),this.PdfReaderModule.singleInstance=!0}static get ImageIOModule(){return this.imageIOModule}static get CryptoModule(){return i(this,h,"f",b)}static get PdfReaderModule(){return i(this,h,"f",A)}static get ImagecoreModule(){return i(this,h,"f",B)}static get ImageProcModule(){return i(this,h,"f",x)}static get PdfWriterModule(){return i(this,h,"f",D)}static get LogLevel(){return i(this,h,"f",W)}static setLogFunc(e,t,i){s(this,h,e,"f",W),s(this,h,t,"f",F),s(this,h,i,"f",O)}static get LogFunc(){return i(this,h,"f",F)}static get LogContext(){return i(this,h,"f",O)}}h=Et,T=function(e){this.LicMode==o.DLS_KEY&&e.dependencyModules&&-1!=e.dependencyModules.indexOf(a.imgIO)&&-1==e.dependencyModules.indexOf(a.crypto)&&e.dependencyModules.push(a.crypto)},_=function(){i(this,h,"m",T).call(this,i(this,h,"f",B)),i(this,h,"m",T).call(this,i(this,h,"f",x)),i(this,h,"m",T).call(this,i(this,h,"f",D))},S=function(e){var t,s,a,n,r;let o={crossScript:!1,resourceDir:e.resourceDir,workerScript:e.workerScript,useFastCompEdition:null!==(t=e.useFastCompEdition)&&void 0!==t&&t,useSimd:null!==(s=e.useSimd)&&void 0!==s?s:i(this,h,"f",y),fetchOptions:null!==(a=e.fetchOptions)&&void 0!==a?a:i(this,h,"f",R),defHeapSize:null!==(n=e.defHeapSize)&&void 0!==n?n:this.DefHeapSize,maxHeapSize:null!==(r=e.maxHeapSize)&&void 0!==r?r:this.MaxHeapSize};return o.workerScript=e.resourceDir+e.workerScript,o.workerScript.startsWith("http://")||o.workerScript.startsWith("https://")?(o.resourceDir=e.resourceDir,o.workerScript.startsWith(location.origin)||(o.crossScript=!0)):e.resourceDir.startsWith("/")?null!=location.origin&&(o.resourceDir=location.origin+e.resourceDir):null!=location.href&&(o.resourceDir=location.href.substring(0,location.href.lastIndexOf("/")+1)+e.resourceDir),o.resourceDir.endsWith("/")||(o.resourceDir+="/"),e.useFastCompEdition&&(o.resourceDir+="fastcomp/",o.workerScript=o.resourceDir+e.workerScript),o},P=function(e,t){t.resourceDir=e.resourceDir,t.crossScript=e.crossScript,t.name===a.imgProc?t.useSimd=e.useSimd:t.useSimd=!1,t.script=e.workerScript,t.fetchOptions=e.fetchOptions,t.defHeapSize=e.defHeapSize,t.maxHeapSize=e.maxHeapSize},f={value:""},m={value:o.LONG_KEY},p={value:""},g={value:null},v={value:!1},y={value:!1},k={value:32},I={value:200},R={value:{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}},w={value:{resourceDir:"",workerScript:Et.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:i(Et,h,"f",R),defHeapSize:Et.DefHeapSize,maxHeapSize:Et.MaxHeapSize}},M={value:{resourceDir:"",workerScript:Et.PdfReaderWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:i(Et,h,"f",R),defHeapSize:Et.DefHeapSize,maxHeapSize:Et.MaxHeapSize}},Et.imageIOModule={name:a.imgIO,autoLoad:!1,ver:L.imgIOVer,prefixName:Et.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:i(Et,h,"f",R)},b={value:{name:a.crypto,autoLoad:!1,ver:L.cryptoVer,prefixName:Et.CryptoPrefixName,dependencyModules:[a.imgIO],fetchOptions:i(Et,h,"f",R)}},A={value:{name:a.pdfR,autoLoad:!1,ver:L.pdfRVer,prefixName:Et.PdfReaderPrefixName,dependencyModules:[],fetchOptions:i(Et,h,"f",R)}},B={value:{name:a.core,autoLoad:!1,ver:L.coreVer,prefixName:Et.ImagecorePrefixName,dependencyModules:[a.imgIO],fetchOptions:i(Et,h,"f",R)}},x={value:{name:a.imgProc,autoLoad:!1,ver:L.imgProcVer,prefixName:Et.ImageProcPrefixName,dependencyModules:[a.imgIO,a.core],useSimd:Et.UseSimd}},D={value:{name:a.pdfW,autoLoad:!1,ver:L.pdfWVer,prefixName:Et.PdfWriterPrefixName,dependencyModules:[a.imgIO,a.core],useSimd:Et.UseSimd}},W={value:""},F={value:void 0},O={value:null};class Nt{constructor(e,t,a,n,r){C.add(this),E.set(this,void 0),N.set(this,void 0),j.set(this,void 0),H.set(this,void 0),J.set(this,void 0),z.set(this,void 0),U.set(this,void 0),G.set(this,void 0),V.set(this,void 0),Y.set(this,void 0),q.set(this,void 0),K.set(this,void 0),Q.set(this,0),X.set(this,{}),Z.set(this,null),s(this,E,e,"f"),s(this,V,a,"f"),s(this,j,[],"f"),s(this,H,!1,"f"),s(this,J,!1,"f"),s(this,Q,t,"f"),s(this,Z,Object.create(null),"f"),i(this,X,"f").modulesInfo=[],s(this,q,Object.create(null),"f"),s(this,z,n,"f"),s(this,U,r,"f"),s(this,G,null,"f"),s(this,Y,0,"f"),s(this,K,0,"f"),s(this,N,i(this,C,"m",ee).call(this,i(this,E,"f")),"f"),i(this,N,"f").on("message",i(this,C,"m",se),this),i(this,N,"f").on("error",i(this,C,"m",ie),this),i(this,N,"f").on("exit",(function(t,s,a){let n="Worker #terminated Unexpectedly\n";n+=" exitCode: `"+t+"`\n",n+=" signalCode: `"+s+"`\n",n+=" #script: `"+e+"`\n",i(a,C,"m",ie).call(a,new Error(n),a)}),this)}get WorkerScript(){return i(this,V,"f")}setLogFunc(e,t){s(this,z,e,"f"),s(this,U,t,"f")}get id(){return i(this,Q,"f")}get Module(){return i(this,X,"f")}set Module(e){s(this,X,e,"f")}get Instances(){return i(this,Z,"f")}execTask(e,t,a){a||((a={}).promise=new Promise((function(e,t){a.resolve=e,a.reject=t})));let n=s(this,K,+i(this,K,"f")+1,"f");i(this,q,"f")[n]={id:n,resolver:a};let r={id:n,func:e,params:t};return i(this,C,"m",te).call(this,e+" send"),i(this,J,"f")?a.reject(new Error("Worker is #terminated")):i(this,H,"f")?a.reject(new Error("Worker is #terminating")):i(this,N,"f").wasmReady||i(this,N,"f").ready&&"loadWasm"===e?i(this,N,"f").send(r):i(this,j,"f").push(r),a.promise}get memSize(){return i(this,Y,"f")}get busy(){return this.howManyTasks>0}get howManyTasks(){return Object.keys(i(this,q,"f")).length}get alive(){return!i(this,H,"f")&&!i(this,J,"f")}terminate(e,t){if(i(this,C,"m",te).call(this,"worker terminate "+e),e&&i(this,C,"m",ne).call(this,"Worker has been #terminated"),"function"==typeof t&&s(this,G,t,"f"),this.busy)s(this,H,!0,"f");else{if(i(this,N,"f")){if("function"!=typeof i(this,N,"f").terminate)throw new Error("Failed to terminate worker");i(this,N,"f").terminate(),s(this,N,null,"f")}s(this,H,!1,"f"),s(this,J,!0,"f"),i(this,G,"f")&&i(this,G,"f").call(this,this)}}}E=new WeakMap,N=new WeakMap,j=new WeakMap,H=new WeakMap,J=new WeakMap,z=new WeakMap,U=new WeakMap,G=new WeakMap,V=new WeakMap,Y=new WeakMap,q=new WeakMap,K=new WeakMap,Q=new WeakMap,X=new WeakMap,Z=new WeakMap,C=new WeakSet,$=function(e){let t=new Error(""),i=Object.keys(e);for(let s=0;s<i.length;s++)t[i[s]]=e[i[s]];return t},ee=function(e){if("function"!=typeof Worker&&"object"!=typeof Worker)throw new Error("Web Workers not supported");let t=new Worker(e);return t.on=function(e,t,i){this.addEventListener(e,(function(s){"exit"===e?t(s.data,"",i):t(s.data,i)}))},t.send=function(e){if(null!=e&&null!=e.params&&null!=e.params.input){let t=Object.prototype.toString.call(e.params.input);if("[object Array]"===Object.prototype.toString.call(e.params.input)){if(t=Object.prototype.toString.call(e.params.input[0]),"[object ArrayBuffer]"===t||"[object Uint8ClampedArray]"===t||"[object Uint8Array]"===t)return void this.postMessage(e,[null!=e.params.input[0].buffer?e.params.input[0].buffer:e.params.input[0]])}else if("[object ArrayBuffer]"===t||"[object Uint8ClampedArray]"===t||"[object Uint8Array]"===t)return void this.postMessage(e,[null!=e.params.input.buffer?e.params.input.buffer:e.params.input])}this.postMessage(e)},t},te=function(e){i(this,z,"f")&&i(this,z,"f").call(this,e,i(this,U,"f"))},ie=function(e,t){s(t,J,!0,"f"),i(t,C,"m",te).call(t,"[js]["+Date.now()/1e3+"] worker error "+JSON.stringify(e)),i(t,H,"f")&&i(t,G,"f")&&i(t,G,"f").call(t,t),s(t,H,!1,"f"),i(t,C,"m",ne).call(t)},se=function(e,t){if(i(t,C,"m",te).call(t,e.log?e.log:e),"string"==typeof e&&"ready"===e)i(t,N,"f").ready=!0,i(t,C,"m",ae).call(t);else if(!e.log){if("object"==typeof e){let i=e.result;"object"==typeof i?(null!=i.errorCode&&(i.code=i.errorCode,delete i.errorCode),null!=i.errorMessage&&(i.message=i.errorMessage,delete i.errorMessage)):"string"==typeof i&&(i=i.replace('"errorCode"','"code"'),i=i.replace("'errorCode'","'code'"),i=i.replace('"errorMessage"','"message"'),i=i.replace("'errorMessage'","'message'"),e.result=i),null!=e.memSize&&s(t,Y,e.memSize,"f")}let a=e.id,n=i(t,q,"f")[a];void 0!==n&&(delete i(t,q,"f")[a],i(t,C,"m",te).call(t,e.func+" received"),!0===i(t,H,"f")&&t.terminate(),"loadWasm"===e.func&&null!=e.result&&(i(t,N,"f").wasmReady=!0,i(t,C,"m",ae).call(t)),e.error?n.resolver.reject(i(t,C,"m",$).call(t,e.error)):e.result&&n.resolver.resolve(e.result))}},ae=function(){i(this,j,"f").forEach(i(this,N,"f").send.bind(i(this,N,"f"))),s(this,j,[],"f")},ne=function(e){for(let t in i(this,q,"f"))void 0!==i(this,q,"f")[t]&&i(this,q,"f")[t].resolver.reject(new Error(e));s(this,q,Object.create(null),"f")};class jt{constructor(){re.add(this),de.set(this,[]),ue.set(this,2),ce.set(this,60),he.set(this,!1),fe.set(this,void 0),me.set(this,null),pe.set(this,a.logDebug),ve.set(this,!1)}static get Instance(){return i(this,oe,"f",le)||s(this,oe,new jt,"f",le),i(this,oe,"f",le)}get Terminated(){return i(this,he,"f")}getModuleLoadedError(e){for(let t of i(jt,oe,"f",ge))if(t.name==e)return t.error}getModuleStatus(e){for(let t of i(jt,oe,"f",ge))if(t.name==e)return t.status;return""}addModules(e){let t=!1;if(i(jt,oe,"f",ge).forEach((function(i,s,a){i.name==e.name&&(i.ver==e.ver?t=!0:a.splice(s,1))})),!t){let t=e;t.status="",t.wasmModule=null,i(jt,oe,"f",ge).push(t)}}loadModule(e,s){return t(this,void 0,void 0,(function*(){let t=null;null==s&&(s=0!=i(this,re,"m",be).call(this,e).length);for(let t of e.dependencyModules)t===a.imgIO?(this.addModules(Et.ImageIOModule),Et.LicMode===o.DLS_KEY&&this.addModules(Et.CryptoModule)):t===a.core&&this.addModules(Et.ImagecoreModule);for(let a of i(jt,oe,"f",ge))if(a.name===e.name){if(a.wasmModule){if(s)return!0;t=a;break}if(a.status===n.pending)return!1;t=a;break}if(t)if(""===t.status)t.status=n.pending,t.wasmModule=null;else{if(t.status===n.pending)return null;s||(t.error={code:0,message:""},t.status=n.pending)}else t=e,t.status=n.pending,t.wasmModule=null,i(jt,oe,"f",ge).push(t);return i(this,re,"m",ye).call(this,t)}))}setLogFunc(e,t,i){s(this,fe,t,"f"),s(this,me,i,"f"),s(this,pe,e,"f")}get busy(){i(this,re,"m",De).call(this);let e=i(this,de,"f");for(let t of e)if(t.busy)return!0;return!1}getWorker(e,s){return t(this,void 0,void 0,(function*(){if(i(this,re,"m",Ae).call(this,e.name))return i(this,re,"m",xe).call(this),null;let t=i(this,re,"m",be).call(this,e);return 0!=t.length?i(this,re,"m",We).call(this,t,s,!e.singleInstance):(yield this.loadModule(e,!1),null)}))}removeInstanceInWorker(e,t,s,a){var n;if(i(this,re,"m",Fe).call(this,t,s),a&&t&&null!=t.memSize){let s=1024*(null!==(n=e.maxHeapSize)&&void 0!==n?n:Et.MaxHeapSize)*1024;if(i(this,re,"m",we).call(this,"current memSize="+t.memSize+", max="+s),t.memSize>s&&0!=s&&!i(this,re,"m",Oe).call(this,t)){i(this,re,"m",we).call(this,"try to terminate the worker"),t.terminate();let e=i(this,de,"f").indexOf(t);-1!==e&&i(this,de,"f").splice(e,1)}}}terminate(e){s(jt,oe,null,"f",le),i(this,re,"m",we).call(this,"worker pool terminate "+e),s(this,he,!0,"f");let t=[],a=i(this,de,"f").slice();return s(this,de,[],"f"),a.forEach((function(i){let s={};s.promise=new Promise((function(e,t){s.resolve=e,s.reject=t})),t.push(s.promise),i.terminate(e,(function(e){s.resolve(e)}))})),Promise.all(t)}terminateWorker(e){const t=i(this,de,"f").filter((t=>!t.Module.modulesInfo[e.name]||(t.terminate(!0),!1)));s(this,de,t,"f")}getMemoryUsed(){let e=i(this,de,"f"),t=[],s=0;for(let i of e)i&&null!=i.memSize&&(t[s++]=i.memSize);return t}}oe=jt,de=new WeakMap,ue=new WeakMap,ce=new WeakMap,he=new WeakMap,fe=new WeakMap,me=new WeakMap,pe=new WeakMap,ve=new WeakMap,re=new WeakSet,ye=function(e){return t(this,void 0,void 0,(function*(){let t=this,a=yield i(this,re,"m",Me).call(this,e);if(a){let r={id:0,func:"loadWasm",params:{insId:0,priority:0,module:{modulesInfo:[]},fetchOptions:e.fetchOptions}};if(r.params.resourceDir=e.resourceDir,r.params.initMemory=e.defHeapSize,r.params.module){for(let t of i(jt,oe,"f",ge))for(let i of e.dependencyModules)i==t.name&&r.params.module.modulesInfo.push(t);r.params.module.modulesInfo.push(e)}return i(this,re,"m",_e).call(this,a,r,(function(a){s(t,ue,i(t,re,"m",Ie).call(t),"f"),e.status===n.pending&&(e.status="")}))}e.status=""}))},Te=function(e,t,s,a){for(let n of i(jt,oe,"f",ge))if(n.name===e){n.status=t,n.wasmModule=s,n.error=a;break}},_e=function(e,s,a){return t(this,void 0,void 0,(function*(){let t=this;try{const n=yield e.execTask(s.func,s.params);let r=!1;return void 0===n.code||n.modules?r=i(t,re,"m",ke).call(t,n,e):i(t,re,"m",we).call(t,n),r}catch(e){return i(t,re,"m",we).call(t,e),!1}finally{a&&a()}}))},ke=function(e,t){if(i(this,re,"m",we).call(this,"handleWasmLoad:"),i(this,re,"m",we).call(this,e),("object"!=typeof e||null==e.modules)&&"object"==typeof e)return!1;let s=!1;for(const a of e.modules)e.code?(i(this,re,"m",Te).call(this,a.name,n.failed,null,{code:e.code,message:e.message}),t.Module.modulesInfo[a.name]=!1):(i(this,re,"m",Te).call(this,a.name,n.ready,a.wasmModule,void 0),t.Module.modulesInfo[a.name]=!0,s=!0);return s},Ie=function(){let e=2;return"hardwareConcurrency"in self.navigator&&(e=self.navigator.hardwareConcurrency),Math.max(Math.min(i(this,ue,"f"),Math.max(i(this,ue,"f"),e/2)),1)},Se=function(){Et.LogLevel==i(this,pe,"f")&&Et.LogFunc==i(this,fe,"f")||this.setLogFunc(Et.LogLevel,Et.LogFunc,Et.LogContext)},Re=function(e){i(this,re,"m",Se).call(this),i(this,fe,"f")&&i(this,pe,"f")===a.logAll&&i(this,fe,"f").call(this,e,i(this,me,"f"))},we=function(e){i(this,re,"m",Se).call(this),i(this,fe,"f")&&i(this,pe,"f")===a.logDebug&&i(this,fe,"f").call(this,e,i(this,me,"f"))},Me=function(e){return t(this,void 0,void 0,(function*(){i(this,re,"m",De).call(this);let t=i(this,de,"f");for(let i of t)if(i.WorkerScript===e.script)return i.busy?null:i;return i(this,re,"m",Pe).call(this,e)}))},Pe=function(e){return t(this,void 0,void 0,(function*(){let t=this,a=i(t,de,"f");if(a.length<i(t,ue,"f")&&!i(t,ve,"f")){s(t,ve,!0,"f");let n=e.script;e.crossScript&&(n=yield class{static fetchRetry(e,t,i,s){let a=t.retries,n=t.retryDelay;return new Promise((function(r,o){const l=function(d){fetch(e,t).then((function(e){r(e)})).catch((function(e){d<a?function(e,t,a){i&&i(t,s),setTimeout((function(){l(++e)}),n)}(d,e):o(e)}))};l(0)}))}}.fetchRetry(e.script,e.fetchOptions,i(t,fe,"f"),t).then((e=>e.blob())).then((e=>URL.createObjectURL(e))).catch((e=>(i(t,re,"m",we).call(t,"get new worker fetch failed: "),i(t,re,"m",we).call(t,e),s(t,ve,!1,"f"),null))));let r=new Nt(n,a.length+1,e.script,i(t,fe,"f"),i(t,me,"f"));return a.push(r),s(t,ve,!1,"f"),i(t,re,"m",Re).call(t,a),i(t,re,"m",we).call(t,"get new worker "+r.id+" succeed!"),r}return null}))},be=function(e){i(this,re,"m",De).call(this);let t=i(this,de,"f");i(this,re,"m",Re).call(this,t);let s=[];for(let a of t)if(a.Module.modulesInfo[e.name]){if(a.busy&&t.length<i(this,ue,"f"))continue;s.push(a)}return i(this,re,"m",Re).call(this,"get workers for module "+e.name),i(this,re,"m",Re).call(this,s),s},Ae=function(e){for(let t of i(jt,oe,"f",ge))if(t.name===e&&t.status===n.pending)return!0;return!1},Be=function(){return t(this,void 0,void 0,(function*(){this.terminate(!0);for(let e of i(jt,oe,"f",ge))yield i(this,re,"m",ye).call(this,e)}))},xe=function(){i(this,re,"m",De).call(this),0==i(this,de,"f").length&&0!=i(jt,oe,"f",ge).length&&(i(this,re,"m",we).call(this,"no worker ready, reinit"),i(this,re,"m",Be).call(this))},De=function(){s(this,de,i(this,de,"f").filter((function(e){return e.alive})),"f")},We=function(e,t,s){i(this,re,"m",Re).call(this,"getWorkerByIntanceId"),i(this,re,"m",Re).call(this,e);let a,n=9007199254740991;for(let i of e){if(!s&&0!=Object.keys(i.Instances).length)return null;if(null!=i.Instances[t]){a=i;break}{let e=i.howManyTasks;e<n&&(a=i,n=e)}}return a?(a.Instances[t]="",i(this,re,"m",Re).call(this,e),i(this,re,"m",we).call(this,"get worker "+t+" in "+a.id+" succeed!"),""!=i(this,pe,"f")&&a.setLogFunc(i(this,fe,"f"),i(this,me,"f")),a):(i(this,re,"m",Re).call(this,"#getWorkerByIntanceId: no suitable worker"),null)},Fe=function(e,t){let s=i(this,de,"f");i(this,re,"m",Re).call(this,"removeInstanceInWorkerInner"),i(this,re,"m",Re).call(this,s);for(let a of s)if(a===e){null!=a.Instances[t]?(delete a.Instances[t],i(this,re,"m",Re).call(this,s),i(this,re,"m",we).call(this,"removeInstanceInWorkerInner "+t+" in "+e.id+" succeed!")):i(this,re,"m",we).call(this,"not found instance "+t);break}},Oe=function(e){return 0!=Object.keys(e.Instances).length},le={value:null},ge={value:new Array},function(e){e.Text="Text",e.Link="Link",e.FreeText="FreeText",e.Line="Line",e.Square="Square",e.Circle="Circle",e.Polygon="Polygon",e.PolyLine="PolyLine",e.Hignlight="Hignlight",e.Underline="Underline",e.Squiggly="Squiggly",e.StrikeOut="StrikeOut",e.Stamp="Stamp",e.Caret="Caret",e.Ink="Ink",e.Popup="Popup"}(Le||(Le={})),function(e){e.None="none",e.Invisible="invisible",e.Hidden="hidden",e.Print="print",e.NoZoom="noZoom",e.NoRotate="noRotate",e.NoView="noView",e.ReadOnly="readOnly",e.Locked="locked",e.ToggleNoView="toggleNoView",e.LockedContents="lockedContents"}(Ce||(Ce={})),function(e){e.Solid="S",e.Dashed="D",e.Beveled="B",e.Insert="I",e.Underline="U"}(Ee||(Ee={})),function(e){e.NoEffect="S",e.Cloudy="C"}(Ne||(Ne={})),function(e){e.Comment="Comment",e.Key="Key",e.Note="Note",e.Help="Help",e.NewParagraph="NewParagraph",e.Paragraph="Paragraph",e.Insert="Insert"}(je||(je={})),function(e){e.Marked="Marked",e.Review="Review"}(He||(He={})),function(e){e.Accepted="Accepted",e.Rejected="Rejected",e.Cancelled="Cancelled",e.Completed="Completed",e.None="None"}(Je||(Je={})),function(e){e.None="None",e.Square="Square",e.Circle="Circle",e.Diamond="Diamond",e.OpenArrow="OpenArrow",e.ClosedArrow="ClosedArrow",e.Butt="Butt",e.ROpenArrow="ROpenArrow",e.RClosedArrow="RClosedArrow",e.Slash="Slash"}(ze||(ze={})),function(e){e[e.LeftJustified=0]="LeftJustified",e[e.Centered=1]="Centered",e[e.RightJustified=2]="RightJustified"}(Ue||(Ue={})),function(e){e.FreeText="FreeText",e.FreeTextCallout="FreeTextCallout",e.FreeTextTypeWriter="FreeTextTypeWriter"}(Ge||(Ge={})),function(e){e.LineArrow="LineArrow",e.LineDimension="LineDimension"}(Ve||(Ve={})),function(e){e.Approved="Approved",e.Experimental="Experimental",e.NotApproved="NotApproved",e.Asls="Asls",e.Expired="Expired",e.NotForPublicRelease="NotForPublicRelease",e.Confidential="Confidential",e.Final="Final",e.Sold="Sold",e.Departmental="Departmental",e.ForComment="ForComment",e.TopSecret="TopSecret",e.Draft="Draft",e.ForPublicRelease="ForPublicRelease"}(Ye||(Ye={}));class Ht extends class{constructor(e){this.type=void 0,this.rectangle=void 0,this.contents=void 0,this.name=void 0,this.modifiedDate=void 0,this.flags=void 0,this.border=void 0,this.color=void 0,this.normalAppearance=void 0,this.type=e}toJsonString(){return JSON.stringify(this)}}{constructor(e){super(e),this.title=void 0,this.opacity=void 0,this.richText=void 0,this.creationDate=void 0,this.subject=void 0}}class Jt{}Jt.PdfAnnotType=Le,Jt.PdfAnnotFlag=Ce,Jt.PdfAnnotBorderStyleStyle=Ee,Jt.PdfAnnotBorderEffectStyle=Ne,Jt.PdfAnnotTextName=je,Jt.PdfAnnotTextStateModel=He,Jt.PdfAnnotTextState=Je,Jt.PdfAnnotLineEnding=ze,Jt.PdfAnnotFreeTextQuadding=Ue,Jt.PdfAnnotFreeTextIntent=Ge,Jt.PdfAnnotLineIntent=Ve,Jt.PdfAnnotStampName=Ye,Jt.PdfAnnotAppearance=class{constructor(){this.annot=void 0}},Jt.PdfAnnotBorderStyle=class{constructor(){this.width=void 0,this.style=void 0,this.dash=void 0}},Jt.PdfAnnotBorderEffect=class{constructor(){this.style=void 0,this.intensity=void 0}},Jt.PdfTextAnnot=class extends Ht{constructor(){super(Le.Text),this.open=void 0,this.iconName=void 0,this.state=void 0,this.stateModel=void 0}},Jt.PdfFreeTextAnnot=class extends Ht{constructor(){super(Le.FreeText),this.defaultAppearance=void 0,this.q=void 0,this.defaultStyle=void 0,this.callout=void 0,this.intent=void 0,this.borderEffect=void 0,this.rectDifference=void 0,this.borderStyle=void 0,this.lineEnding=void 0}},Jt.PdfLineAnnot=class extends Ht{constructor(e,t,i,s){super(Le.Line),this.line=void 0,this.borderStyle=void 0,this.lineEnding=void 0,this.interiorColor=void 0,this.leadLineLength=void 0,this.leadLineExtensionLength=void 0,this.caption=void 0,this.intent=void 0,this.leadLineOffsetLength=void 0,this.captionPosition=void 0,this.captionOffset=void 0,this.line=[e,t,i,s]}},Jt.PdfSquareAnnot=class extends Ht{constructor(){super(Le.Square),this.borderStyle=void 0,this.interiorColor=void 0,this.borderEffect=void 0,this.rectDifference=void 0}},Jt.PdfCircleAnnot=class extends Ht{constructor(){super(Le.Circle),this.borderStyle=void 0,this.interiorColor=void 0,this.borderEffect=void 0,this.rectDifference=void 0}},Jt.PdfPolygonAnnot=class extends Ht{constructor(){super(Le.Polygon),this.vertices=void 0,this.borderStyle=void 0,this.borderEffect=void 0}},Jt.PdfPolyLineAnnot=class extends Ht{constructor(){super(Le.PolyLine),this.vertices=void 0,this.borderStyle=void 0,this.lineEnding=void 0,this.borderEffect=void 0}},Jt.PdfHighlightAnnot=class extends Ht{constructor(){super(Le.Hignlight),this.quadPoints=void 0}},Jt.PdfUnderlineAnnot=class extends Ht{constructor(){super(Le.Underline),this.quadPoints=void 0}},Jt.PdfStrikeOutAnnot=class extends Ht{constructor(){super(Le.StrikeOut),this.quadPoints=void 0}},Jt.PdfSquigglyAnnot=class extends Ht{constructor(){super(Le.Squiggly),this.quadPoints=void 0}},Jt.PdfRubberStampAnnot=class extends Ht{constructor(){super(Le.Stamp),this.name=void 0}},Jt.PdfInkAnnot=class extends Ht{constructor(){super(Le.Ink),this.inkList=void 0,this.borderStyle=void 0}};class zt{constructor(t,a){var r,l,d,u;qe.add(this),Xe.set(this,void 0),this._outputType=e.ImageType.IT_JPG,this._inputType=e.ImageType.IT_ALL,this._jpegQuality=80,Ze.set(this,null!==(r=Et.License)&&void 0!==r?r:""),$e.set(this,[]),et.set(this,null),tt.set(this,0),it.set(this,""),st.set(this,null),at.set(this,null),nt.set(this,s(u=zt,Ke,+i(u,Ke,"f",Qe)+1,"f",Qe)),rt.set(this,null),ot.set(this,JSON.parse(JSON.stringify(Et.NavInfo))),lt.set(this,Et.Mobile),dt.set(this,location.origin),ut.set(this,""),ct.set(this,n.init),ht.set(this,!1),ft.set(this,null!==(l=Et.LicMode)&&void 0!==l?l:o.LONG_KEY),mt.set(this,null!==(d=Et.UUID)&&void 0!==d?d:""),this._handleBooleanResult=function(e,t){return!0},s(this,Xe,t,"f"),s(this,Ze,null!=a?a:Et.License,"f"),this.setLog(Et.LogLevel,Et.LogFunc,Et.LogContext)}_prepareModule(e){}setLog(e,t,i){s(this,st,null!=t?t:null,"f"),s(this,at,i,"f"),s(this,it,null!=e?e:"","f")}_log(e){"function"==typeof i(this,st,"f")&&i(this,st,"f").call(this,e,i(this,at,"f"))}_logAll(e){i(this,it,"f")===a.logAll&&this._log(e)}_handleBasicResult(e,t){return delete e.code,delete e.message,e}_handleImageData(e,t){var s,a,n;if("object"==typeof e.imageData)if(null!=e.imageCount&&e.imageCount>1)for(let a=0;a<e.imageCount;a++)e.imageData[a]=i(s=t.context,qe,"m",yt).call(s,e.imageData[a],e.blobType,t.params.returnBlob);else e.imageData=i(a=t.context,qe,"m",yt).call(a,e.imageData,e.blobType,t.params.returnBlob);return"object"==typeof e.pdfData&&(e.pdfData=i(n=t.context,qe,"m",yt).call(n,e.pdfData,e.blobType,t.params.returnBlob)),e}_handleResult(e,t){var s,a,n;let o=i(a=t.context,qe,"m",Tt).call(a,e);if(void 0===o.code||!o.code&&"Successful."===o.message){o=t.handleResult(o,t),i(n=t.context,qe,"m",gt).call(n),(0,t.resolve)(o)}else{let e={code:o.code,message:o.code===l.wasmException?r.WASM_EXCEPTION_ERROR+"("+(null===(s=t.params)||void 0===s?void 0:s.moduleName)+":"+t.func+":"+o.message+")":o.message};t.context.terminated?t.resolve(e):t.reject(e)}}_execTask(e){let t=this,s=i(t,et,"f");if(t._logAll(e),s)try{s.execTask(e.func,e.params).then((function(s){t._log(s),t._handleResult(i(t,qe,"m",Tt).call(t,s),e)})).catch((function(s){t._log(s),i(t,qe,"m",gt).call(t);let a=s;"object"==typeof s&&null!=s.message&&(a=s.message);let n={code:l.wasmJsWorkerRunFailed,message:a};i(t,ht,"f")?e.resolve(n):e.reject(n)}))}catch(s){i(t,qe,"m",gt).call(t),t._log(s);let a={code:l.wasmJsWorkerRunException,message:s.message,stack:s.stack};i(t,ht,"f")?e.resolve(a):e.reject(a)}}_cancelAllTasks(e,t){for(let s of i(this,$e,"f"))if(void 0!==s){let a={code:e,message:t};i(this,ht,"f")?s.resolve(a):s.reject(a)}s(this,$e,[],"f")}_createTask(t,n,r){let o={moduleName:i(this,Xe,"f").name,insId:i(this,nt,"f")},l={id:s(this,tt,+i(this,tt,"f")+1,"f"),func:t,params:o};return l.promise=new Promise((function(e,t){l.resolve=e,l.reject=t})),l.func=t,l.context=this,l.handleResult=void 0!==r&&r?r:this._handleBasicResult,l.params.input=void 0!==n&&n?n:"",l.params.returnType=e.ReturnedDataType.RT_AUTO,l.params.returnBlob=!0,Et.LogLevel===a.logDebug&&(l.params.logLevel=a.logDebug),l}_addTask(e,t){return i(this,ct,"f")===n.destroyed?e.reject({code:l.wasmJsObjectNotInit,message:i(this,ht,"f")?"object has been disposed":"object not init"}):i(this,ct,"f")===n.failed?e.reject({code:l.wasmJsObjectInitFailed,message:i(this,ut,"f")}):(t?i(this,$e,"f").unshift(e):i(this,$e,"f").push(e),i(this,qe,"m",gt).call(this)),e.promise}terminate(e){let t=this;e=null==e||e;let a=i(t,qe,"m",kt).call(t);s(t,ht,!0,"f");let n=jt.Instance;n&&n.removeInstanceInWorker(i(t,Xe,"f"),i(t,et,"f"),i(t,nt,"f"),e),a.then((function(e){s(t,et,null,"f"),t._log(i(t,Xe,"f").name+" destroy return: "),t._log(e)})).catch((function(e){s(t,et,null,"f"),t._log(i(t,Xe,"f").name+" destroy failed"),t._log(e)})),s(t,ct,"","f")}_readFile(e,t){return new Promise((function(s,a){(class{static read(e){return new Promise((function(t,i){let s=Object.prototype.toString.call(e);if("[object String]"===s)0===e.indexOf("blob:")||e.indexOf(".jpg")>0||e.indexOf(".jpeg")>0||e.indexOf(".png")>0||e.indexOf(".bmp")>0||e.indexOf(".dib")>0||e.indexOf(".pdf")>0||e.indexOf(".tiff")>0||e.indexOf(".tif")>0?fetch(e,{mode:"cors"}).then((function(e){return e.arrayBuffer()})).then((function(e){return t(e)})).catch((function(e){return Promise.reject(e)})):i("Error url: Can not read the file URL");else if("[object Blob]"===s||"[object FileList]"===s||"[object File]"===s){let i=e;"[object FileList]"!==s&&"[object File]"!==s||(i=e[0]?e[0]:e);let a=new FileReader;a.readAsArrayBuffer(i),a.onload=function(){let e=a.result;t(e)}}else"[object ArrayBuffer]"===s||"[object Uint8ClampedArray]"===s?t(e):i("Not support source type: "+s)}))}}).read(e).then((function(e){s(e)}),(function(e){var s;i(s=t.context,qe,"m",vt).call(s,t,e,l.wasmJsReadFileFailed)})).catch((function(e){var s;i(s=t.context,qe,"m",vt).call(s,t,e,l.wasmJsReadFileFailed)}))}))}}Ke=zt,Xe=new WeakMap,Ze=new WeakMap,$e=new WeakMap,et=new WeakMap,tt=new WeakMap,it=new WeakMap,st=new WeakMap,at=new WeakMap,nt=new WeakMap,rt=new WeakMap,ot=new WeakMap,lt=new WeakMap,dt=new WeakMap,ut=new WeakMap,ct=new WeakMap,ht=new WeakMap,ft=new WeakMap,mt=new WeakMap,qe=new WeakSet,pt=function e(t){let a=null!=t?t:this;if(i(a,rt,"f")&&clearTimeout(i(a,rt,"f")),i(a,et,"f")&&i(a,et,"f").alive)return i(a,et,"f");let n=jt.Instance;n?n.getWorker(i(a,Xe,"f"),i(a,nt,"f")).then((t=>{if(s(a,et,t,"f"),i(a,et,"f")&&i(a,et,"f").alive)i(a,$e,"f").length>0&&i(a,qe,"m",gt).call(a);else{let t=n.getModuleLoadedError(i(a,Xe,"f").name);if(null==t?void 0:t.code)return a._cancelAllTasks(l.wasmJsNotLoaded,t.message),i(a,et,"f");i(a,$e,"f").length>0&&s(a,rt,setTimeout(i(a,qe,"m",e),50,a),"f")}return i(a,et,"f")})).catch((e=>i(a,et,"f"))):a._cancelAllTasks(l.wasmJsNotLoaded,"wasm env not loaded or unloaded")},gt=function(){if(this._logAll(i(this,$e,"f")),i(this,ct,"f")!=n.init)if(i(this,et,"f")&&i(this,et,"f").alive){if(i(this,$e,"f").length>0){let e=i(this,$e,"f")[0];i(this,ct,"f")!==n.ready&&"init"!==e.func||(delete i(this,$e,"f")[0],i(this,$e,"f").splice(0,1),this._execTask(e))}}else{if(i(this,et,"f")&&!i(this,et,"f").alive&&i(this,$e,"f").length>0&&"init"!=i(this,$e,"f")[0].func)return s(this,et,null,"f"),void i(this,qe,"m",_t).call(this);i(this,$e,"f").length>0&&i(this,qe,"m",pt).call(this,this)}else i(this,qe,"m",_t).call(this)},vt=function(e,t,i){let s=t;return"object"!=typeof s&&(s={},s.code=i,s.message=t),e.context.terminated?e.resolve(s):e.reject(s)},yt=function(e,t,i){if(i){let i;return i=null!=t?new Blob([e],{type:t}):new Blob([e]),i}return e},Tt=function(e){try{return"string"==typeof e?JSON.parse(e):e}catch(t){return e}},_t=function(){let e=this;e._prepareModule(i(this,Xe,"f"));let t=this._createTask("init");t.params.key=i(this,Ze,"f"),t.params.uuid=i(this,mt,"f"),t.params.licMode=i(this,ft,"f"),t.params.val={nv:i(this,ot,"f"),mb:i(this,lt,"f"),dm:i(this,dt,"f")},t.handleResult=function(e,t){return s(t.context,ct,n.ready,"f"),e},s(this,ct,n.pending,"f"),this._addTask(t,!0),t.promise.then((function(t){e._log(i(e,Xe,"f").name+" init return: "),e._log(t)})).catch((function(t){s(e,ct,n.failed,"f"),s(e,ut,t.message,"f"),e._log(i(e,Xe,"f").name+" init failed"),e._log(t),e._cancelAllTasks(l.wasmJsObjectInitFailed,t.message)}))},kt=function(){if(i(this,ct,"f")==n.pending||i(this,ct,"f")==n.ready){let e=this._createTask("destroy");return this._addTask(e),e.promise}return Promise.resolve(!0)},Qe={value:0};class Ut extends zt{constructor(e,t){super(e,t)}_prepareModule(e){let t=jt.Instance;t.addModules(Et.ImageIOModule),Et.LicMode===o.DLS_KEY&&t.addModules(Et.CryptoModule),i(Ut,It,"m",St).call(Ut,Et.ImageIOModule,e),t.addModules(e)}}It=Ut,St=function(e,t){t.resourceDir=e.resourceDir,t.crossScript=e.crossScript,t.script=e.script,t.useSimd=e.useSimd,t.name===a.imgProc?t.useSimd=Et.UseSimd:t.useSimd=!1,t.fetchOptions=e.fetchOptions,t.defHeapSize=e.defHeapSize,t.maxHeapSize=t.maxHeapSize};class Gt extends Ut{constructor(e){super(Et.ImagecoreModule,e),Rt.add(this),wt.set(this,0)}getImageFormat(e){return t(this,void 0,void 0,(function*(){let t=this,i=t._createTask("GetImageFormat");const s=yield t._readFile(e,i);return i.params.input=s,t._addTask(i),i.promise}))}readImageInfo(e){return t(this,void 0,void 0,(function*(){let t=this,i=t._createTask("ReadImageInfo");const s=yield t._readFile(e,i);return i.params.input=s,t._addTask(i),i.promise}))}getMD5(e){return t(this,void 0,void 0,(function*(){let t=this,i=t._createTask("GetMD5");const s=yield t._readFile(e,i);return i.params.input=s,i.handleResult=function(e,t){return e.MD5},t._addTask(i),i.promise}))}getLicenseInfo(){return t(this,void 0,void 0,(function*(){return this._addTask(this._createTask("GetLicenseInfo"))}))}getAesResult(e){return t(this,void 0,void 0,(function*(){return e=null!=e?e:"",this._addTask(this._createTask("GetAesResult",[e]))}))}saveImage(e,s,a,n,r){return t(this,void 0,void 0,(function*(){return(r=null!=r&&r)?i(this,Rt,"m",Mt).call(this,e,void 0,void 0,void 0,1,void 0,void 0,s,a,n):i(this,Rt,"m",Mt).call(this,e,void 0,void 0,void 0,void 0,void 0,void 0,s,a,n)}))}readImage(i,s,a,n,r){return t(this,void 0,void 0,(function*(){s=null!=s?s:this._outputType,a=null!=a?a:this._jpegQuality,n=null!=n&&n,r=null!=r&&r;let t=this,o=t._createTask("ReadImage");const l=yield t._readFile(i,o);return o.params.input=[l,s,a,r],o.params.returnType=n?e.ReturnedDataType.RT_BASE64:e.ReturnedDataType.RT_AUTO,o.params.returnBlob=!n,o.handleResult=t._handleImageData,t._addTask(o),o.promise}))}openTiff(e){return t(this,void 0,void 0,(function*(){let t=this,i=t._createTask("LoadTiff");const s=yield t._readFile(e,i);i.params.input=s,t._addTask(i);const a=yield i.promise;if(a.srcBuffer){let t=Object.prototype.toString.call(e);"[object ArrayBuffer]"!=t&&"[object Uint8ClampedArray]"!=t&&delete a.srcBuffer}return a}))}readTiff(t,i,s,a){t=null!=t?t:0,i=null!=i?i:this._outputType,s=null!=s&&s,a=null!=a&&a;let n=this._createTask("ReadTiffPage");return n.params.input=[t,i,a],n.params.returnType=s?e.ReturnedDataType.RT_BASE64:e.ReturnedDataType.RT_AUTO,n.params.returnBlob=!s,n.handleResult=this._handleImageData,this._addTask(n)}readTiffInfo(e){e=null!=e?e:0;let t=this._createTask("GetTiffPageInfo");return t.params.input=[e],this._addTask(t)}closeTiff(){return this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))}createTiff(){return this._addTask(this._createTask("NewTiff",null,this._handleBooleanResult))}appendImage(e,s,a,n,r){return t(this,void 0,void 0,(function*(){s=null!=s?s:this._inputType,a=null!=a?a:i(this,wt,"f"),n=null!=n?n:this._jpegQuality,r=null!=r&&r;let t=this,o=t._createTask("AppendImageToTiff");const l=yield t._readFile(e,o);return o.params.input=[l,s,a,n,r],o.handleResult=t._handleBooleanResult,t._addTask(o),o.promise}))}addTag(e,t,i){return i=null!=i&&i,this._addTask(this._createTask("AddTagToNextPage",[e,t,i],this._handleBooleanResult))}getTiff(t){let i=this._createTask("GetTiffStream");return i.handleResult=this._handleImageData,i.params.returnType=null!=t?t:e.ReturnedDataType.RT_AUTO,i.params.returnBlob=t!=e.ReturnedDataType.RT_AUTO,this._addTask(i)}getMemoryUsed(){return this._addTask(this._createTask("getMemoryUsed",null,(function(e,t){return e.memoryUsed})))}getMultiPartFile(e,t){return this._addTask(this._createTask("ds_get_file",[e,t],(function(e,t){return e})))}}wt=new WeakMap,Rt=new WeakSet,Mt=function(i,s,a,n,r,o,l,d,u,c){return t(this,void 0,void 0,(function*(){let t=this;s=null!=s?s:this._inputType,a=null!=a?a:0,n=null!=n?n:0,r=null!=r?r:24,o=null!=o?o:96,l=null!=l?l:96,d=null!=d?d:this._outputType,u=null!=u?u:this._jpegQuality,c=null!=c?c:e.ReturnedDataType.RT_AUTO;let h=t._createTask("SaveImage");const f=yield t._readFile(i,h);return h.params.input=[f,s,a,n,r,o,l,d,u],h.params.returnType=c,h.params.returnBlob=c!=e.ReturnedDataType.RT_BASE64,h.handleResult=t._handleImageData,t._addTask(h),h.promise}))},function(e){e[e.NearestNeighbour=1]="NearestNeighbour",e[e.Bilinear=2]="Bilinear",e[e.Bicublic=3]="Bicublic",e[e.BestQuality=5]="BestQuality"}(Pt||(Pt={}));class Vt extends Ut{constructor(e){super(Et.ImageProcModule,e)}initImage(i,s,a,n,r){return t(this,void 0,void 0,(function*(){s=null!=s&&s,a=null!=a?a:0,n=null!=n?n:0,r=null!=r&&r;let t=this,o=t._createTask("InitImageObject");if(o.params.input=[i,a,n],s||r)s?o.params.input.push(e.ImageType.IT_RGBA):o.params.input.push(e.ImageType.IT_BGRA),t._addTask(o);else{const s=yield t._readFile(i,o);o.params.input[0]=s,o.params.input.push(e.ImageType.IT_ALL),t._addTask(o)}return o.promise}))}rotate(e,t,i,s){return e=null!=e?e:0,i=null!=i&&i,s=null!=s?s:Pt.Bicublic,t=null!=t?t:"FFFFFF",(e<0||e>360)&&(e%=360)<0&&(e+=360),this._addTask(this._createTask("RotateEx",[e,i,s,t],this._handleBooleanResult))}flip(e){e=null!=e?e:1;let t=this._createTask("");return t.handleResult=this._handleBooleanResult,1===e?t.func="Flip":-1===e&&(t.func="Mirror"),this._addTask(t),t.promise}erase(e,t,i,s,a){a=null!=a?a:"FFFFFF";let n=this._createTask("Erase");return n.handleResult=this._handleBooleanResult,n.params.input=[e,t,i,s,a],this._addTask(n),n.promise}crop(e,t,i,s){return this._addTask(this._createTask("Crop",[e,t,i,s],this._handleBooleanResult))}resize(e,t,i){return i=null!=i?i:Pt.BestQuality,this._addTask(this._createTask("ChangeImageSize",[e,t,i],this._handleBooleanResult))}toGrayscale(e){(e=null!=e?e:1)<1&&(e=1),e>3&&(e=3);let t="";return 1===e?t="0":2===e?t="3;3;720;1.05":3===e&&(t="3;5;1080;1.05"),this._addTask(this._createTask("ConvertToGrayScale",t,this._handleBooleanResult))}toBinary(e,t){(t=null!=t?t:1)<1&&(t=1),t>3&&(t=3);let i="";return null!=e&&(e?i="1":1===t?i="0":2===t?i="2;3;720;1.05":3===t&&(i="2;5;1080;1.05")),this._addTask(this._createTask("ConvertToBWScale",i,this._handleBooleanResult))}invert(){return this._addTask(this._createTask("Invert",null,this._handleBooleanResult))}setImageWidth(e,t){return t=null!=t?t:"FFFFFF",this._addTask(this._createTask("SetImageWidth",[e,t],this._handleBooleanResult))}setImageHeight(e,t){return t=null!=t?t:"FFFFFF",this._addTask(this._createTask("SetImageHeight",[e,t],this._handleBooleanResult))}setDPI(e,t,i,s,a,n){return a=null!=a&&a,n=null!=n?n:Pt.Bilinear,this._addTask(this._createTask("SetDPI",[e,t,i,s,a,n],this._handleBooleanResult))}getImage(t,i,s,a,n,r,o,l,d){t=null!=t?t:this._jpegQuality,i=null==i||i,a=null!=a?a:0,n=null!=n?n:0,r=null!=r?r:0,o=null==o||o,l=(s=null!=s&&s)&&null==l?e.ImageType.IT_JPG:null!=l?l:e.ImageType.IT_ALL,d=null!=d&&d;let u=this._createTask("GetCurrentImage");return u.params.input=[l,a,n,r,!1,t,i,d],u.params.returnBlob=o,u.handleResult=this._handleImageData,this._addTask(u)}getSkewAngle(e){return e=null!=e?e:"",this._addTask(this._createTask("GetSkewAngle",[e],(function(e,t){return e.skewAngle})))}freeReservedData(){return this._addTask(this._createTask("FreeReservedData",null,this._handleBooleanResult))}detectDocument(e,t,i,s,a){e=null!=e?e:Pt.Bilinear,t=null!=t?t:75,i=null!=i?i:100,s=null!=s?s:0,a=null!=a?a:"";return this._addTask(this._createTask("DocumentDetect",[e,t/100,i,s/255,a,"1"]))}perspective(e,t,i,s,a,n,r,o){return this._addTask(this._createTask("Perspective",[e,t,i,s,a,n,r,o],this._handleBooleanResult))}changeBrightness(e,t){return e=null!=e?e:0,0!=(t=null!=t?t:1)&&1!=t&&(t=0),1===t?this._addTask(this._createTask("ChangeBrightnessAndContrast",[e,0],this._handleBooleanResult)):this._addTask(this._createTask("ChangeBrightness",[Math.floor(e/1e3*255)],this._handleBooleanResult))}changeContrast(e,t){return e=null!=e?e:0,0!=(t=null!=t?t:1)&&1!=t&&(t=0),1===t?this._addTask(this._createTask("ChangeBrightnessAndContrast",[0,e],this._handleBooleanResult)):this._addTask(this._createTask("ChangeContrast",[1+e/1e3],this._handleBooleanResult))}changeBrightnessAndContrast(e,t){return e=null!=e?e:0,t=null!=t?t:0,this._addTask(this._createTask("ChangeBrightnessAndContrast",[e,t],this._handleBooleanResult))}removeShadow(e,t){t=null!=t?t:1.05,(e=null!=e?e:1)<1&&(e=1),e>3&&(e=3);let i="5";return 1===e?i+=";3;720;"+t:2===e?i+=";5;1080;"+t:3===e&&(i+=";10;0;"+t),this._addTask(this._createTask("ShadowRemovel",[i],this._handleBooleanResult))}enhanceAndSharpenImage(){return this._addTask(this._createTask("EnhanceAndSharpen",[""],this._handleBooleanResult))}brighten(){return this._addTask(this._createTask("Brighten",[""],this._handleBooleanResult))}getBlurryScore(){return this._addTask(this._createTask("GetBlurScore",[""],(function(e,t){return e.blurryScore})))}drawQuadrangle(e,t,i,s,a,n,r,o,l,d){let u=(l=null!=l?l:"FFFFFF")+";"+(d=null!=d?d:5);return this._addTask(this._createTask("DrawQuadrangle",[e,t,i,s,a,n,r,o,u],this._handleBooleanResult))}}class Yt{static resize(e,i,s,a,n,r){return t(this,void 0,void 0,(function*(){if(a<=0||a>=i&&a>=s)return{imageData:e};r=null!=r&&r;let t=new Vt;try{yield t.initImage(e);let o,l,d,u=null!=n?n:Pt.BestQuality;return d=i>s?i/a:s/a,o=Math.floor(i/d+.5),l=Math.floor(s/d+.5),r?(yield t.resize(o,l,u),yield t.toBinary(!1)):yield t.resize(o,l,u),yield t.getImage()}finally{t.terminate()}}))}static createImage(s){var a,n,r,o,l,d,u,c,h;return t(this,void 0,void 0,(function*(){let t=new Vt;try{let f={src:null,result:null,preview:null},m=s.source,p=s.output,g=null!==(n=null!==(a=m.imageWidth)&&void 0!==a?a:m.width)&&void 0!==n?n:0,v=null!==(o=null!==(r=m.imageHeight)&&void 0!==r?r:m.height)&&void 0!==o?o:0,y=m.imageData||m.data;if(null==p||null==p.orgImage&&null==p.previewImage)return f;let T=null!==(l=m.rgba)&&void 0!==l&&l,_=null!==(d=m.bgra)&&void 0!==d&&d,k=null!==(u=s.doPerspective)&&void 0!==u&&u,I=m.angle||0,S=yield t.initImage(y,T,g,v,_);f.src=S.srcBuffer,k&&s.polygon&&(yield t.perspective(s.polygon.points[0],s.polygon.points[1],s.polygon.points[2],s.polygon.points[3],s.polygon.points[4],s.polygon.points[5],s.polygon.points[6],s.polygon.points[7])),0!=I&&((I<0||I>360)&&(I%=360,I<0&&(I+=360)),yield t.rotate(I));let R=!1;if(p.orgImage){let i=null==p.orgImage.returnBlob||p.orgImage.returnBlob,s=null!=m.imageBitDepth?m.imageBitDepth:void 0,a=null!=m.imageXResolution?m.imageXResolution:void 0,n=null!=m.imageYResolution?m.imageYResolution:void 0,r=Et.NavInfo.bMac||Et.NavInfo.biPhone||Et.NavInfo.biPad,o=yield t.getImage(p.orgImage.quality,R,T||_,s,a,n,i,p.orgImage.returnType,r);p.orgImage.returnType==e.ImageType.IT_BGRA?o.bgra=!0:p.orgImage.returnType==e.ImageType.IT_RGBA&&(o.rgba=!0),f.result=o}if(p.previewImage){let a=g,n=v;90!=I&&270!=I||(a=v,n=g);let r,o,l=Math.min((null!==(c=p.previewImage.width)&&void 0!==c?c:g)/a,(null!==(h=p.previewImage.height)&&void 0!==h?h:v)/n);if(90==I||270==I?(r=Math.floor(v*l+.5),o=Math.floor(g*l+.5)):(r=Math.floor(g*l+.5),o=Math.floor(v*l+.5)),yield t.resize(r,o,p.previewImage.nInterplationMethod),s.polygon&&!k){let e=s.polygon.points;0!=I&&(e=i(this,bt,"m",At).call(this,e,I,a,n)),yield t.drawQuadrangle(Math.floor(e[0]*l+.5),Math.floor(e[1]*l+.5),Math.floor(e[2]*l+.5),Math.floor(e[3]*l+.5),Math.floor(e[4]*l+.5),Math.floor(e[5]*l+.5),Math.floor(e[6]*l+.5),Math.floor(e[7]*l+.5),s.polygon.strokeColor,s.polygon.lineWidth)}let d=null==p.previewImage.returnBlob||p.previewImage.returnBlob,u=yield t.getImage(p.previewImage.quality,!0,T||_,void 0,void 0,void 0,d,p.previewImage.returnType);p.previewImage.returnType==e.ImageType.IT_BGRA?u.bgra=!0:p.previewImage.returnType==e.ImageType.IT_RGBA&&(u.rgba=!0),f.preview=u}return f}finally{t.terminate()}}))}static resizeImageWithMeta(i,s,a,n,r){return t(this,void 0,void 0,(function*(){let t=null!=n?n:85,o=new Vt,l=null!=r?r:0;try{yield o.initImage(i);let n,r,d=null!=a?a:Pt.BestQuality;s.imageWidth>s.imageHeight?(n=l,r=Math.floor(s.imageHeight*l/s.imageWidth+.5)):(n=Math.floor(s.imageWidth*l/s.imageHeight+.5),r=l),1==s.imageBitDepth?(yield o.resize(n,r,d),yield o.toBinary(!1)):yield o.resize(n,r,d);let u=!1,c=!0,h=s.imageBitDepth,f=s.imageXResolution,m=s.imageYResolution,p=1==h?e.ImageType.IT_PNG:e.ImageType.IT_JPG;return yield o.getImage(t,u,!1,h,f,m,c,p)}finally{o.terminate()}}))}static getMax4kImage(i,s,a,n){return t(this,void 0,void 0,(function*(){let t,r=null!=a?a:85,o=new Gt;try{let e=yield o.readImageInfo(i);t={imageWidth:e.imageWidth,imageHeight:e.imageHeight,imageBitDepth:e.imageBitDepth,imageXResolution:e.imageXResolution,imageYResolution:e.imageYResolution}}finally{o.terminate()}if((Et.NavInfo.biPhone||Et.NavInfo.biPad)&&n&&(t.imageWidth>n||t.imageHeight>n))return yield Yt.resizeImageWithMeta(i,t,s,a,n);o=new Gt;try{let s=1==t.imageBitDepth?e.ImageType.IT_PNG:e.ImageType.IT_JPG;return yield o.readImage(i,s,r,!1)}finally{o.terminate()}}))}}bt=Yt,At=function(e,t,i,s){let a=[];for(let n=0;n<e.length;n+=2){let r,o;const l=e[n],d=e[n+1];90==t?(r=i-d,o=l):180==t?(r=i-l,o=s-d):270==t?(r=d,o=s-l):(r=l,o=d),a.push(r,o)}return a};class qt{static decode(e){const t={encodeChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",decodeChars:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1]};function i(e){let t,i,s,a,n,r,o,l=[],d=e.length;for(t=0;t<d;t++)a=e.charCodeAt(t),0==(a>>7&255)?l.push(e.charAt(t)):6==(a>>5&255)?(n=e.charCodeAt(++t),i=(31&a)<<6,s=63&n,o=i|s,l.push(String.fromCharCode(o))):14==(a>>4&255)&&(n=e.charCodeAt(++t),r=e.charCodeAt(++t),i=a<<4|n>>2&15,s=(3&n)<<6|63&r,o=(255&i)<<8|s,l.push(String.fromCharCode(o)));return l.join("")}return function(e){let s,a,n,r,o=[],l=0,d=e.length;for(;l<d;){do{s=t.decodeChars[255&e.charCodeAt(l++)]}while(l<d&&-1==s);if(-1==s)break;do{a=t.decodeChars[255&e.charCodeAt(l++)]}while(l<d&&-1==a);if(-1==a)break;o.push(String.fromCharCode(s<<2|(48&a)>>4));do{if(n=255&e.charCodeAt(l++),61==n)return i(o.join(""));n=t.decodeChars[n]}while(l<d&&-1==n);if(-1==n)break;o.push(String.fromCharCode((15&a)<<4|(60&n)>>2));do{if(r=255&e.charCodeAt(l++),61==r)return i(o.join(""));r=t.decodeChars[r]}while(l<d&&-1==r);if(-1==r)break;o.push(String.fromCharCode((3&n)<<6|r))}return i(o.join(""))}(e)}}!function(e){e[e.render=1]="render",e[e.extractImageOnly=2]="extractImageOnly",e[e.auto=3]="auto",e[e.renderWithAnnot=4]="renderWithAnnot"}(Dt||(Dt={}));class Kt extends zt{constructor(t){super(Et.PdfReaderModule,t),Bt.set(this,200),xt.set(this,3),this._outputType=e.ImageType.IT_ALL}open(e,i){return t(this,void 0,void 0,(function*(){i=null!=i?i:"";let t=this,s=t._createTask("LoadPdf");const a=yield t._readFile(e,s);return s.params.input=[a,i],s.handleResult=function(t,i){if(t.srcBuffer){let i=Object.prototype.toString.call(e);"[object ArrayBuffer]"!=i&&"[object Uint8ClampedArray]"!=i&&delete t.srcBuffer}let s=qt.decode(t.infoBase64);try{let e;try{s.replace(new RegExp("\\\\","gi"),"\\\\"),e=JSON.parse(s)}catch(t){e=s}let i={PdfCount:t.pageCount,PdfInfo:e,isTextBased:t.isTextBased};return t.srcBuffer&&(i.srcBuffer=t.srcBuffer,delete t.srcBuffer),i}catch(e){i.reject({code:l.wasmJsInvalidJson,message:e.message,stack:e.stack})}},t._addTask(s),s.promise}))}readPage(s,a,n,r,o,l,d){return t(this,void 0,void 0,(function*(){s=null!=s?s:0,a=null!=a?a:i(this,Bt,"f"),n=null!=n?n:i(this,xt,"f"),r=null!=r?r:this._outputType,l=null!=l&&l,o=null!=o&&o,d=null!=d&&d;let t=this._createTask("ReadPdfPage");return t.params.input=[s,a,n,r,o,d],t.params.returnType=l?e.ReturnedDataType.RT_BASE64:e.ReturnedDataType.RT_AUTO,t.params.returnBlob=!l,t.handleResult=this._handleImageData,this._addTask(t)}))}close(){return t(this,void 0,void 0,(function*(){return this._addTask(this._createTask("UnloadPdf",null,this._handleBooleanResult))}))}readPageAnnot(e){return t(this,void 0,void 0,(function*(){e=null!=e?e:0;let t=this._createTask("ReadPdfAnnot",[e]);return t.handleResult=function(e,t){let i=qt.decode(e.annotBase64);try{let t;try{i.replace(new RegExp("\\\\","gi"),"\\\\"),t=JSON.parse(i)}catch(e){t=i}return{code:e.code,message:e.message,pageIndex:e.pageIndex,annots:t}}catch(e){t.reject({code:l.wasmJsInvalidJson,message:e.message,stack:e.stack})}},this._addTask(t)}))}setRenderLimitImageSize(e,i){return t(this,void 0,void 0,(function*(){return e=null!=e?e:0,i=null!=i?i:0,this._addTask(this._createTask("SetRenderLimitImageSize",[e,i],this._handleBooleanResult))}))}findText(e,i,s){return t(this,void 0,void 0,(function*(){return s=null!=s?s:0,this._addTask(this._createTask("FindText",[e,i,s]))}))}addSystemFont(e,i){return t(this,void 0,void 0,(function*(){return this._addTask(this._createTask("AddSystemFont",[e,i]))}))}getModifiedPdf(i){return t(this,void 0,void 0,(function*(){let t=this._createTask("GetModifiedPdf");return t.params.returnType=null!=i?i:e.ReturnedDataType.RT_AUTO,t.params.returnBlob=i!=e.ReturnedDataType.RT_AUTO,t.handleResult=this._handleImageData,this._addTask(t)}))}addAnnot(e,i){return t(this,void 0,void 0,(function*(){e=null!=e?e:0;let t=i.toJsonString();return this._addTask(this._createTask("PageAddAnnot",[e,t],this._handleBooleanResult))}))}addImage(e,i,s){return t(this,void 0,void 0,(function*(){e=null!=e?e:0;let t=JSON.stringify(s),a=this,n=a._createTask("PageAddImage");const r=yield a._readFile(i,n);return n.params.input=[e,t,r,0,0],n.handleResult=a._handleBooleanResult,a._addTask(n),n.promise}))}addText(e,i){return t(this,void 0,void 0,(function*(){e=null!=e?e:0;let t=JSON.stringify(i);return this._addTask(this._createTask("PageAddText",[e,t],this._handleBooleanResult))}))}addPath(e,i){return t(this,void 0,void 0,(function*(){let t=JSON.stringify(i);return this._addTask(this._createTask("PageAddPath",[e,t],this._handleBooleanResult))}))}deleteAnnot(e,i){return t(this,void 0,void 0,(function*(){return e=null!=e?e:0,i=null!=i?i:0,this._addTask(this._createTask("PageDeleteAnnot",[e,i],this._handleBooleanResult))}))}deletePage(e){return t(this,void 0,void 0,(function*(){return e=null!=e?e:0,this._addTask(this._createTask("DeletePdfPage",[e],this._handleBooleanResult))}))}changePagesOrder(e){return t(this,void 0,void 0,(function*(){e=null!=e?e:[];let t="";for(let i=0;i<e.length;i++)0!=i&&(t+=","),t+=e[i]+1;return this._addTask(this._createTask("ChangePagesOrder",[t],this._handleBooleanResult))}))}rotatePageLeft(e){return t(this,void 0,void 0,(function*(){return e=null!=e?e:0,this._addTask(this._createTask("PageRotateLeft",[e],this._handleBooleanResult))}))}rotatePageRight(e){return t(this,void 0,void 0,(function*(){return e=null!=e?e:0,this._addTask(this._createTask("PageRotateRight",[e],this._handleBooleanResult))}))}insertBlankPage(e,i,s){return t(this,void 0,void 0,(function*(){return e=null!=e?e:0,i=null!=i?i:595,s=null!=s?s:842,this._addTask(this._createTask("InsertBlankPdfPage",[e,i,s],this._handleBooleanResult))}))}mergePdf(e,i,s,a){return t(this,void 0,void 0,(function*(){a=null!=a?a:-1,s=null!=s?s:[],i=null!=i?i:"";let t=this,n=t._createTask("MergePdfPage"),r="";for(let e=0;e<s.length;e++)0!=e&&(r+=","),r+=s[e]+1;const o=yield t._readFile(e,n);return n.params.input=[o,a,i,r],n.handleResult=t._handleBooleanResult,t._addTask(n),n.promise}))}getPageInfo(e){return t(this,void 0,void 0,(function*(){return e=null!=e?e:0,this._addTask(this._createTask("GetPdfPageInfo",[e]))}))}}Bt=new WeakMap,xt=new WeakMap;class Qt{static buildWasmFileName(e,t,i,s){return e+(s?"sn-":"")+t+i}static base64DecToArr(e,t){let s=e.replace(/[^A-Za-z0-9\+\/]/g,""),a=s.length,n=t?Math.ceil((3*a+1>>>2)/t)*t:3*a+1>>>2,r=new Uint8Array(n);for(let e,t,o=0,l=0,d=0;d<a;d++)if(t=3&d,o|=i(this,Wt,"m",Ft).call(this,s.charCodeAt(d))<<18-6*t,3===t||a-d==1){for(e=0;e<3&&l<n;e++,l++)r[l]=o>>>(16>>>e&24)&255;o=0}return r}static isWasmSupport(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){let e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}return!1}static random(){return(Date.now()%10086).toString(36).slice(2)+Math.random().toString(36).slice(2)}}Wt=Qt,Ft=function(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:43===e?62:47===e?63:0},function(e){e[e.auto=0]="auto",e[e.store=1]="store"}(Ct||(Ct={}));Ot=new WeakSet,Lt=function(e){let t={};if(null!=e&&"object"==typeof e)for(let i in e)t[i]=e[i];return t};class Xt{static log(e,t){this.logLevel===t&&("function"==typeof this.logFunc?this.logFunc(e):console.log(e))}static setLoglevel(e,t){this.logLevel=1===e?a.logDebug:"",this.logFunc=t,Et.setLogFunc(this.logLevel,t)}static getMemoryUsed(){return jt.Instance.getMemoryUsed()}static getLicenseInfo(e,i,s){return t(this,void 0,void 0,(function*(){this.Init(e,i,s),yield jt.Instance.loadModule(Et.ImageIOModule);const t=new Gt(this.productKey);try{return yield t.getLicenseInfo()}finally{t.terminate()}}))}static Init(e,t,i){this.productKey=null!=e?e:this.productKey,void 0!==t&&(this.licMode=t?1:0),this.uuid=null!=i?i:this.uuid,Et.License=this.productKey,Et.UUID=this.uuid,Et.LicMode=this.licMode,Et.NavInfo=JSON.parse(JSON.stringify(Dynamsoft.navInfo)),Et.Mobile=Dynamsoft.Lib.env.bMobile,this.simdFlag===c.SF_ENABLE?Et.UseSimd=!0:this.simdFlag===c.SF_DISABLE?Et.UseSimd=!1:Et.UseSimd=this.getUseSimd();const s={resourceDir:this.resourceDir,workerScript:"",useFastCompEdition:this.useFastcompEdition,useSimd:Et.UseSimd,fetchOptions:this.fetchOptions,defHeapSize:Et.DefHeapSize,maxHeapSize:Et.MaxHeapSize};s.workerScript=Et.ImageIOWorkerJS,s.defHeapSize=this.wasmHeap[this.ImageIOWasm].initHeapSize,s.maxHeapSize=this.wasmHeap[this.ImageIOWasm].maxHeapSize,Et.ImageIOResource=s;const a=Object.assign({},s);a.defHeapSize=this.wasmHeap[this.PdfReaderWasm].initHeapSize,a.maxHeapSize=this.wasmHeap[this.PdfReaderWasm].maxHeapSize,a.workerScript=Et.PdfReaderWorkerJS,Et.PdfReaderResource=a,""===this.logLevel||this.logFunc||this.setLoglevel(1,console.log)}static loadPdfReader(e,i,s){return t(this,void 0,void 0,(function*(){this.Init(e,i,s),yield jt.Instance.loadModule(Et.ImageProcModule);return yield jt.Instance.loadModule(Et.PdfReaderModule)}))}static loadMain(e,i,s){return t(this,void 0,void 0,(function*(){this.Init(e,i,s);const t=yield jt.Instance.loadModule(Et.ImagecoreModule);return jt.Instance.loadModule(Et.ImageProcModule),t}))}static load(e,i,s){return t(this,void 0,void 0,(function*(){jt.Instance.terminate(!0),this.Init(e,i,s),yield this.loadMain(e,i,s),yield this.loadPdfReader(e,i,s)}))}static unloadMain(){jt.Instance.terminateWorker(Et.ImageIOModule)}static unloadPdfReader(){jt.Instance.terminateWorker(Et.PdfReaderModule)}static unload(){return t(this,void 0,void 0,(function*(){yield jt.Instance.terminate(!0)}))}static getUseSimd(){if(this.useFastcompEdition)return!1;if(this.simdFlag===c.SF_DEF){if(void 0!==navigator.userAgentData&&void 0!==navigator.userAgentData.brands){const{brands:e}=navigator.userAgentData;for(const t of e)if(t.brand&&("Chromium"===t.brand||"Google Chrome"===t.brand)&&t.version&&parseInt(t.version,10)>=94)return!0}}else if(this.simdFlag===c.SF_ENABLE)return!0;return!1}}Xt.resourceDir=`${Dynamsoft.DWT.ResourcesPath}/src/`,Xt.logLevel=Dynamsoft.DWT.Debug?a.logDebug:"",Xt.logFunc=null,Xt.productKey="",Xt.licMode=o.LONG_KEY,Xt.uuid="",Xt.fetchOptions={mode:"cors",credentials:"same-origin",retries:3,retryDelay:500},Xt.simdFlag=c.SF_DEF,Xt.useFastcompEdition=!1,Xt.ImageIOWasm=0,Xt.PdfReaderWasm=1,Xt.wasmHeap=[{maxHeapSize:300,initHeapSize:Et.DefHeapSize},{maxHeapSize:200,initHeapSize:Et.DefHeapSize}];e.ImageProc=Vt,e.ImageProcWrapper=Yt,e.ImagecoreEx=class extends Gt{constructor(e){super(e)}readTiff(e,i,s,a,n,r,o){const l=Object.create(null,{readTiff:{get:()=>super.readTiff}});return t(this,void 0,void 0,(function*(){const t=yield l.readTiff.call(this,e,i,s,a);let d={imageWidth:t.imageWidth,imageHeight:t.imageHeight,imageBitDepth:t.imageBitDepth,imageXResolution:t.imageXResolution,imageYResolution:t.imageYResolution};return o&&(d.imageWidth>o||d.imageHeight>o)?Yt.resizeImageWithMeta(t.imageData,d,n,r,o):t}))}},e.PdfAnnot=Jt,e.PdfReaderEx=class extends Kt{constructor(e){super(e)}readPage(e,i,s,a,n,r,o,l,d,u){const c=Object.create(null,{readPage:{get:()=>super.readPage}});return t(this,void 0,void 0,(function*(){const t=yield c.readPage.call(this,e,i,s,a,n,r,o);let h={imageWidth:t.imageWidth,imageHeight:t.imageHeight,imageBitDepth:t.imageBitDepth,imageXResolution:t.imageXResolution,imageYResolution:t.imageYResolution};return u&&(h.imageWidth>u||h.imageHeight>u)?yield Yt.resizeImageWithMeta(t.imageData,h,l,d,u):t}))}},e.PdfSettings=class{constructor(){this.version=void 0,this.compression=void 0,this.author=void 0,this.creationDate=void 0,this.creator=void 0,this.keywords=void 0,this.modifiedDate=void 0,this.producer=void 0,this.subject=void 0,this.title=void 0,this.quality=void 0,this.jpegMode=void 0}},e.PdfWriter=class extends Ut{constructor(e){super(Et.PdfWriterModule,e),Ot.add(this)}initPdfSetting(e){return t(this,void 0,void 0,(function*(){let t=this,s=t._createTask("InitPdfWriter");return s.params.input=JSON.stringify(i(t,Ot,"m",Lt).call(t,e)),s.handleResult=this._handleBooleanResult,t._addTask(s)}))}appendPage(e,i){return t(this,void 0,void 0,(function*(){let t=this,s=t._createTask("AddPageFromImageFileStream");i=null!=i&&i;const a=yield t._readFile(e,s);return s.params.input=[a,i],s.handleResult=t._handleBooleanResult,t._addTask(s),s.promise}))}writePdf(i){return t(this,void 0,void 0,(function*(){let t=this._createTask("GetPdfContent");return t.params.returnType=null!=i?i:e.ReturnedDataType.RT_AUTO,t.params.returnBlob=i!=e.ReturnedDataType.RT_AUTO,t.handleResult=this._handleImageData,this._addTask(t)}))}newPage(e,i){return t(this,void 0,void 0,(function*(){e=null!=e?e:595,i=null!=i?i:842;let t=this._createTask("NewPdfPage");return t.params.input=[e,i],t.handleResult=this._handleBooleanResult,this._addTask(t)}))}writePage(){return t(this,void 0,void 0,(function*(){let e=this._createTask("WritePdfPage");return e.handleResult=this._handleBooleanResult,this._addTask(e)}))}pageSetRotate(e){return t(this,void 0,void 0,(function*(){0!==(e=null!=e?e:0)&&90!==e&&180!==e&&270!==e&&(e=0);let t=this._createTask("PdfPageSetRotate");return t.params.input=[e],t.handleResult=this._handleBooleanResult,this._addTask(t)}))}pageAddImage(e,s,a,n){return t(this,void 0,void 0,(function*(){let t=this,r=t._createTask("PdfPageAddImage");n=null!=n&&n,s=null!=s?s:0;let o=JSON.stringify(i(t,Ot,"m",Lt).call(t,a));const l=yield t._readFile(e,r);return r.params.input=[l,s,o,n],r.handleResult=t._handleBooleanResult,t._addTask(r),r.promise}))}},e.WasmEnv=Xt,e.pdf=class{static IsModuleInstalled(){if(Qt.isWasmSupport()){const e=jt.Instance.getModuleStatus(a.pdfR),t=jt.Instance.getModuleStatus(a.pdfW);return e===n.ready&&t===n.ready}return!1}},Object.defineProperty(e,"__esModule",{value:!0})}));
Dynamsoft.WasmEnv = Dynamsoft.ImageIO.WasmEnv;  Dynamsoft.Imagecore = Dynamsoft.ImageIO.ImagecoreEx;  Dynamsoft.ImageProc = Dynamsoft.ImageIO.ImageProc;  Dynamsoft.PdfReader = Dynamsoft.ImageIO.PdfReaderEx;  Dynamsoft.PdfWriter = Dynamsoft.ImageIO.PdfWriter;  Dynamsoft.ImageProcWrapper = Dynamsoft.ImageIO.ImageProcWrapper;  Dynamsoft.pdf = Dynamsoft.ImageIO.pdf;  Dynamsoft.ImageProcWrapper = Dynamsoft.ImageIO.ImageProcWrapper;  Dynamsoft.Enum_ImageType = Dynamsoft.ImageIO.ImageType;  Dynamsoft.Enum_ReturnType = Dynamsoft.ImageIO.ReturnedDataType;  